function cov_104nsp5hwb(){var path="/Users/robertpringle/Documents/GitHub/Individual-Project/src/backend/routes/auth.js";var hash="f0a03d54bcad38075ebf9398459fe0d32e50bd09";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/robertpringle/Documents/GitHub/Individual-Project/src/backend/routes/auth.js",statementMap:{"0":{start:{line:1,column:16},end:{line:1,column:34}},"1":{start:{line:2,column:15},end:{line:2,column:42}},"2":{start:{line:3,column:13},end:{line:3,column:37}},"3":{start:{line:4,column:15},end:{line:4,column:34}},"4":{start:{line:5,column:17},end:{line:5,column:40}},"5":{start:{line:6,column:48},end:{line:6,column:72}},"6":{start:{line:8,column:24},end:{line:8,column:64}},"7":{start:{line:9,column:21},end:{line:9,column:53}},"8":{start:{line:12,column:18},end:{line:12,column:20}},"9":{start:{line:15,column:0},end:{line:61,column:2}},"10":{start:{line:18,column:22},end:{line:18,column:50}},"11":{start:{line:21,column:4},end:{line:26,column:10}},"12":{start:{line:22,column:6},end:{line:26,column:10}},"13":{start:{line:25,column:35},end:{line:25,column:44}},"14":{start:{line:29,column:26},end:{line:29,column:77}},"15":{start:{line:30,column:23},end:{line:30,column:68}},"16":{start:{line:33,column:4},end:{line:34,column:71}},"17":{start:{line:34,column:6},end:{line:34,column:71}},"18":{start:{line:35,column:4},end:{line:35,column:72}},"19":{start:{line:35,column:20},end:{line:35,column:72}},"20":{start:{line:36,column:4},end:{line:36,column:78}},"21":{start:{line:36,column:23},end:{line:36,column:78}},"22":{start:{line:39,column:17},end:{line:39,column:45}},"23":{start:{line:40,column:25},end:{line:40,column:71}},"24":{start:{line:43,column:17},end:{line:47,column:6}},"25":{start:{line:49,column:25},end:{line:51,column:6}},"26":{start:{line:54,column:4},end:{line:59,column:5}},"27":{start:{line:55,column:6},end:{line:55,column:24}},"28":{start:{line:56,column:7},end:{line:56,column:33}},"29":{start:{line:56,column:34},end:{line:56,column:64}},"30":{start:{line:58,column:6},end:{line:58,column:32}},"31":{start:{line:64,column:0},end:{line:115,column:2}},"32":{start:{line:67,column:22},end:{line:67,column:47}},"33":{start:{line:70,column:17},end:{line:70,column:68}},"34":{start:{line:71,column:4},end:{line:74,column:2}},"35":{start:{line:73,column:6},end:{line:73,column:68}},"36":{start:{line:76,column:26},end:{line:79,column:5}},"37":{start:{line:80,column:4},end:{line:80,column:84}},"38":{start:{line:80,column:24},end:{line:80,column:84}},"39":{start:{line:82,column:14},end:{line:86,column:2}},"40":{start:{line:90,column:18},end:{line:92,column:3}},"41":{start:{line:94,column:25},end:{line:98,column:5}},"42":{start:{line:100,column:4},end:{line:100,column:38}},"43":{start:{line:101,column:4},end:{line:101,column:43}},"44":{start:{line:105,column:4},end:{line:111,column:6}},"45":{start:{line:113,column:4},end:{line:113,column:57}},"46":{start:{line:117,column:0},end:{line:139,column:3}},"47":{start:{line:118,column:27},end:{line:118,column:35}},"48":{start:{line:119,column:2},end:{line:138,column:3}},"49":{start:{line:120,column:17},end:{line:124,column:5}},"50":{start:{line:126,column:18},end:{line:128,column:6}},"51":{start:{line:131,column:4},end:{line:131,column:38}},"52":{start:{line:132,column:4},end:{line:132,column:42}},"53":{start:{line:135,column:4},end:{line:135,column:36}},"54":{start:{line:137,column:4},end:{line:137,column:27}},"55":{start:{line:141,column:0},end:{line:157,column:3}},"56":{start:{line:142,column:2},end:{line:155,column:3}},"57":{start:{line:143,column:25},end:{line:143,column:49}},"58":{start:{line:144,column:4},end:{line:144,column:30}},"59":{start:{line:145,column:4},end:{line:152,column:5}},"60":{start:{line:146,column:6},end:{line:146,column:37}},"61":{start:{line:147,column:6},end:{line:147,column:36}},"62":{start:{line:148,column:6},end:{line:148,column:38}},"63":{start:{line:149,column:6},end:{line:149,column:54}},"64":{start:{line:151,column:6},end:{line:151,column:29}},"65":{start:{line:154,column:4},end:{line:154,column:27}},"66":{start:{line:160,column:0},end:{line:176,column:4}},"67":{start:{line:161,column:2},end:{line:167,column:5}},"68":{start:{line:162,column:4},end:{line:166,column:5}},"69":{start:{line:163,column:6},end:{line:163,column:20}},"70":{start:{line:165,column:6},end:{line:165,column:23}},"71":{start:{line:169,column:2},end:{line:175,column:5}},"72":{start:{line:170,column:4},end:{line:174,column:5}},"73":{start:{line:171,column:6},end:{line:171,column:20}},"74":{start:{line:173,column:6},end:{line:173,column:23}},"75":{start:{line:179,column:0},end:{line:179,column:24}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:17,column:18},end:{line:17,column:19}},loc:{start:{line:17,column:38},end:{line:60,column:3}},line:17},"1":{name:"(anonymous_1)",decl:{start:{line:25,column:28},end:{line:25,column:29}},loc:{start:{line:25,column:35},end:{line:25,column:44}},line:25},"2":{name:"(anonymous_2)",decl:{start:{line:66,column:18},end:{line:66,column:19}},loc:{start:{line:66,column:38},end:{line:114,column:3}},line:66},"3":{name:"(anonymous_3)",decl:{start:{line:117,column:22},end:{line:117,column:23}},loc:{start:{line:117,column:36},end:{line:139,column:1}},line:117},"4":{name:"(anonymous_4)",decl:{start:{line:141,column:23},end:{line:141,column:24}},loc:{start:{line:141,column:37},end:{line:157,column:1}},line:141},"5":{name:"(anonymous_5)",decl:{start:{line:160,column:45},end:{line:160,column:46}},loc:{start:{line:160,column:65},end:{line:176,column:1}},line:160},"6":{name:"(anonymous_6)",decl:{start:{line:161,column:50},end:{line:161,column:51}},loc:{start:{line:161,column:72},end:{line:167,column:3}},line:161},"7":{name:"(anonymous_7)",decl:{start:{line:169,column:58},end:{line:169,column:59}},loc:{start:{line:169,column:80},end:{line:175,column:3}},line:169}},branchMap:{"0":{loc:{start:{line:21,column:4},end:{line:26,column:10}},type:"if",locations:[{start:{line:21,column:4},end:{line:26,column:10}},{start:{line:21,column:4},end:{line:26,column:10}}],line:21},"1":{loc:{start:{line:33,column:4},end:{line:34,column:71}},type:"if",locations:[{start:{line:33,column:4},end:{line:34,column:71}},{start:{line:33,column:4},end:{line:34,column:71}}],line:33},"2":{loc:{start:{line:33,column:8},end:{line:33,column:35}},type:"binary-expr",locations:[{start:{line:33,column:8},end:{line:33,column:18}},{start:{line:33,column:22},end:{line:33,column:35}}],line:33},"3":{loc:{start:{line:35,column:4},end:{line:35,column:72}},type:"if",locations:[{start:{line:35,column:4},end:{line:35,column:72}},{start:{line:35,column:4},end:{line:35,column:72}}],line:35},"4":{loc:{start:{line:36,column:4},end:{line:36,column:78}},type:"if",locations:[{start:{line:36,column:4},end:{line:36,column:78}},{start:{line:36,column:4},end:{line:36,column:78}}],line:36},"5":{loc:{start:{line:71,column:4},end:{line:74,column:2}},type:"if",locations:[{start:{line:71,column:4},end:{line:74,column:2}},{start:{line:71,column:4},end:{line:74,column:2}}],line:71},"6":{loc:{start:{line:80,column:4},end:{line:80,column:84}},type:"if",locations:[{start:{line:80,column:4},end:{line:80,column:84}},{start:{line:80,column:4},end:{line:80,column:84}}],line:80},"7":{loc:{start:{line:119,column:2},end:{line:138,column:3}},type:"if",locations:[{start:{line:119,column:2},end:{line:138,column:3}},{start:{line:119,column:2},end:{line:138,column:3}}],line:119},"8":{loc:{start:{line:142,column:2},end:{line:155,column:3}},type:"if",locations:[{start:{line:142,column:2},end:{line:155,column:3}},{start:{line:142,column:2},end:{line:155,column:3}}],line:142},"9":{loc:{start:{line:145,column:4},end:{line:152,column:5}},type:"if",locations:[{start:{line:145,column:4},end:{line:152,column:5}},{start:{line:145,column:4},end:{line:152,column:5}}],line:145},"10":{loc:{start:{line:162,column:4},end:{line:166,column:5}},type:"if",locations:[{start:{line:162,column:4},end:{line:166,column:5}},{start:{line:162,column:4},end:{line:166,column:5}}],line:162},"11":{loc:{start:{line:170,column:4},end:{line:174,column:5}},type:"if",locations:[{start:{line:170,column:4},end:{line:174,column:5}},{start:{line:170,column:4},end:{line:174,column:5}}],line:170}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"f0a03d54bcad38075ebf9398459fe0d32e50bd09"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_104nsp5hwb=function(){return actualCoverage;};}return actualCoverage;}cov_104nsp5hwb();const express=(cov_104nsp5hwb().s[0]++,require("express"));const router=(cov_104nsp5hwb().s[1]++,require("express").Router());const User=(cov_104nsp5hwb().s[2]++,require("../model/user"));const bcrypt=(cov_104nsp5hwb().s[3]++,require("bcryptjs"));const webtoken=(cov_104nsp5hwb().s[4]++,require("jsonwebtoken"));const{registerValidation,loginValidation}=(cov_104nsp5hwb().s[5]++,require("../validation"));const asyncMiddleware=(cov_104nsp5hwb().s[6]++,require("../middleware/asyncMiddleware"));const userProgress=(cov_104nsp5hwb().s[7]++,require("../model/userProgress"));const tokenList=(cov_104nsp5hwb().s[8]++,{});//Register
cov_104nsp5hwb().s[9]++;router.post("/register",asyncMiddleware(async(req,res)=>{cov_104nsp5hwb().f[0]++;const{error}=(cov_104nsp5hwb().s[10]++,registerValidation(req.body));//Sends error message if data is not valid
cov_104nsp5hwb().s[11]++;if(error){cov_104nsp5hwb().b[0][0]++;cov_104nsp5hwb().s[12]++;return res.status(400).send(error.details.map(x=>{cov_104nsp5hwb().f[1]++;cov_104nsp5hwb().s[13]++;return x.message;}).join(", "));}else{cov_104nsp5hwb().b[0][1]++;}//Checks if user details are already in the database
const usernameExist=(cov_104nsp5hwb().s[14]++,await User.findOne({username:req.body.username}));const emailExist=(cov_104nsp5hwb().s[15]++,await User.findOne({email:req.body.email}));//Returns required information to the user
cov_104nsp5hwb().s[16]++;if((cov_104nsp5hwb().b[2][0]++,emailExist)&&(cov_104nsp5hwb().b[2][1]++,usernameExist)){cov_104nsp5hwb().b[1][0]++;cov_104nsp5hwb().s[17]++;return res.status(400).send("Email and Username already exists");}else{cov_104nsp5hwb().b[1][1]++;}cov_104nsp5hwb().s[18]++;if(emailExist){cov_104nsp5hwb().b[3][0]++;cov_104nsp5hwb().s[19]++;return res.status(400).send("Email already exists");}else{cov_104nsp5hwb().b[3][1]++;}cov_104nsp5hwb().s[20]++;if(usernameExist){cov_104nsp5hwb().b[4][0]++;cov_104nsp5hwb().s[21]++;return res.status(400).send("Username already exists");}else{cov_104nsp5hwb().b[4][1]++;}//Hashes the password using Bcrypt
const salt=(cov_104nsp5hwb().s[22]++,await bcrypt.genSaltSync(10));const hashPassword=(cov_104nsp5hwb().s[23]++,await bcrypt.hashSync(req.body.password,salt));//Creates a new user
const user=(cov_104nsp5hwb().s[24]++,new User({username:req.body.username,email:req.body.email,password:hashPassword}));const userprogress=(cov_104nsp5hwb().s[25]++,new userProgress({username:req.body.username}));cov_104nsp5hwb().s[26]++;try{cov_104nsp5hwb().s[27]++;await user.save();cov_104nsp5hwb().s[28]++;await userprogress.save();cov_104nsp5hwb().s[29]++;res.send("Test Successfully");}catch(err){cov_104nsp5hwb().s[30]++;res.status(400).send(err);}}));//Login
cov_104nsp5hwb().s[31]++;router.post("/login",asyncMiddleware(async(req,res)=>{cov_104nsp5hwb().f[2]++;const{error}=(cov_104nsp5hwb().s[32]++,loginValidation(req.body));//Checks if username exists
const user=(cov_104nsp5hwb().s[33]++,await User.findOne({username:req.body.username}));cov_104nsp5hwb().s[34]++;if(!user){cov_104nsp5hwb().b[5][0]++;cov_104nsp5hwb().s[35]++;return res.status(400).send("Incorrect username or password");}else{cov_104nsp5hwb().b[5][1]++;}//Checks if password entered matches the usernames actual password
const validPassword=(cov_104nsp5hwb().s[36]++,await bcrypt.compare(req.body.password,user.password));cov_104nsp5hwb().s[37]++;if(!validPassword){cov_104nsp5hwb().b[6][0]++;cov_104nsp5hwb().s[38]++;return res.status(400).send("Invalid username or password");}else{cov_104nsp5hwb().b[6][1]++;}const body=(cov_104nsp5hwb().s[39]++,{_id:user._id,email:user.email,username:user.username});//Create and assign a JSON web token
const token=(cov_104nsp5hwb().s[40]++,webtoken.sign({info:body},process.env.TOKEN_SECRET,{expiresIn:300}));const refreshToken=(cov_104nsp5hwb().s[41]++,webtoken.sign({info:body},process.env.TOKEN_SECRET,{expiresIn:10000}));cov_104nsp5hwb().s[42]++;res.cookie("access_token",token);cov_104nsp5hwb().s[43]++;res.cookie("refreshJwt",refreshToken);// store tokens in memory
cov_104nsp5hwb().s[44]++;tokenList[refreshToken]={token,refreshToken,email:user.email,_id:user._id,username:user.username};cov_104nsp5hwb().s[45]++;return res.status(200).json({token,refreshToken});}));cov_104nsp5hwb().s[46]++;router.post("/token",(req,res)=>{cov_104nsp5hwb().f[3]++;const{refreshToken}=(cov_104nsp5hwb().s[47]++,req.body);cov_104nsp5hwb().s[48]++;if(refreshToken in tokenList){cov_104nsp5hwb().b[7][0]++;const body=(cov_104nsp5hwb().s[49]++,{email:tokenList[refreshToken].email,_id:tokenList[refreshToken]._id,username:tokenList[refreshToken].username});const token=(cov_104nsp5hwb().s[50]++,webtoken.sign({info:body},process.env.TOKEN_SECRET,{expiresIn:300}));// update jwt
cov_104nsp5hwb().s[51]++;res.cookie("access_token",token);cov_104nsp5hwb().s[52]++;tokenList[refreshToken].token=token;cov_104nsp5hwb().s[53]++;res.status(200).json({token});}else{cov_104nsp5hwb().b[7][1]++;cov_104nsp5hwb().s[54]++;res.status(401).json();}});cov_104nsp5hwb().s[55]++;router.post("/logout",(req,res)=>{cov_104nsp5hwb().f[4]++;cov_104nsp5hwb().s[56]++;if(req.cookies){cov_104nsp5hwb().b[8][0]++;const refreshToken=(cov_104nsp5hwb().s[57]++,req.body['refreshToken']);cov_104nsp5hwb().s[58]++;console.log(refreshToken);cov_104nsp5hwb().s[59]++;if(refreshToken in tokenList){cov_104nsp5hwb().b[9][0]++;cov_104nsp5hwb().s[60]++;delete tokenList[refreshToken];cov_104nsp5hwb().s[61]++;res.clearCookie("refreshJwt");cov_104nsp5hwb().s[62]++;res.clearCookie("access_token");cov_104nsp5hwb().s[63]++;res.status(200).json({message:"logged out"});}else{cov_104nsp5hwb().b[9][1]++;cov_104nsp5hwb().s[64]++;res.status(401).json();}}else{cov_104nsp5hwb().b[8][1]++;cov_104nsp5hwb().s[65]++;res.status(401).json();}});cov_104nsp5hwb().s[66]++;router.post("/deleteAccount",asyncMiddleware(async(req,res)=>{cov_104nsp5hwb().f[5]++;cov_104nsp5hwb().s[67]++;User.deleteOne({username:req.body.username},function(err,result){cov_104nsp5hwb().f[6]++;cov_104nsp5hwb().s[68]++;if(err){cov_104nsp5hwb().b[10][0]++;cov_104nsp5hwb().s[69]++;res.send(err);}else{cov_104nsp5hwb().b[10][1]++;cov_104nsp5hwb().s[70]++;res.send(result);}});cov_104nsp5hwb().s[71]++;userProgress.deleteOne({username:req.body.username},function(err,result){cov_104nsp5hwb().f[7]++;cov_104nsp5hwb().s[72]++;if(err){cov_104nsp5hwb().b[11][0]++;cov_104nsp5hwb().s[73]++;res.send(err);}else{cov_104nsp5hwb().b[11][1]++;cov_104nsp5hwb().s[74]++;res.send(result);}});}));cov_104nsp5hwb().s[75]++;module.exports=router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGguanMiXSwibmFtZXMiOlsiZXhwcmVzcyIsInJlcXVpcmUiLCJyb3V0ZXIiLCJSb3V0ZXIiLCJVc2VyIiwiYmNyeXB0Iiwid2VidG9rZW4iLCJyZWdpc3RlclZhbGlkYXRpb24iLCJsb2dpblZhbGlkYXRpb24iLCJhc3luY01pZGRsZXdhcmUiLCJ1c2VyUHJvZ3Jlc3MiLCJ0b2tlbkxpc3QiLCJwb3N0IiwicmVxIiwicmVzIiwiZXJyb3IiLCJib2R5Iiwic3RhdHVzIiwic2VuZCIsImRldGFpbHMiLCJtYXAiLCJ4IiwibWVzc2FnZSIsImpvaW4iLCJ1c2VybmFtZUV4aXN0IiwiZmluZE9uZSIsInVzZXJuYW1lIiwiZW1haWxFeGlzdCIsImVtYWlsIiwic2FsdCIsImdlblNhbHRTeW5jIiwiaGFzaFBhc3N3b3JkIiwiaGFzaFN5bmMiLCJwYXNzd29yZCIsInVzZXIiLCJ1c2VycHJvZ3Jlc3MiLCJzYXZlIiwiZXJyIiwidmFsaWRQYXNzd29yZCIsImNvbXBhcmUiLCJfaWQiLCJ0b2tlbiIsInNpZ24iLCJpbmZvIiwicHJvY2VzcyIsImVudiIsIlRPS0VOX1NFQ1JFVCIsImV4cGlyZXNJbiIsInJlZnJlc2hUb2tlbiIsImNvb2tpZSIsImpzb24iLCJjb29raWVzIiwiY29uc29sZSIsImxvZyIsImNsZWFyQ29va2llIiwiZGVsZXRlT25lIiwicmVzdWx0IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Im0vUkFlWTsyRkFmWixLQUFNQSxDQUFBQSxPQUFPLDBCQUFHQyxPQUFPLENBQUMsU0FBRCxDQUFWLENBQWIsQ0FDQSxLQUFNQyxDQUFBQSxNQUFNLDBCQUFHRCxPQUFPLENBQUMsU0FBRCxDQUFQLENBQW1CRSxNQUFuQixFQUFILENBQVosQ0FDQSxLQUFNQyxDQUFBQSxJQUFJLDBCQUFHSCxPQUFPLENBQUMsZUFBRCxDQUFWLENBQVYsQ0FDQSxLQUFNSSxDQUFBQSxNQUFNLDBCQUFHSixPQUFPLENBQUMsVUFBRCxDQUFWLENBQVosQ0FDQSxL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QUNHLElBQUosQ0FBU1UsUUFBckIsQ0FBdkIsQ0FBd0QsU0FBU1csR0FBVCxDQUFjbUIsTUFBZCxDQUFzQixrREFDNUUsR0FBSW5CLEdBQUosQ0FBUyxzREFDUHZCLEdBQUcsQ0FBQ0ksSUFBSixDQUFTbUIsR0FBVCxFQUNELENBRkQsSUFFTyxzREFDTHZCLEdBQUcsQ0FBQ0ksSUFBSixDQUFTc0MsTUFBVCxFQUNELENBQ0YsQ0FORCxFQU9ELENBaEIyQyxDQUE1QyxFLHlCQW1CQUMsTUFBTSxDQUFDQyxPQUFQLENBQWlCeEQsTUFBakIiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBleHByZXNzID0gcmVxdWlyZShcImV4cHJlc3NcIik7XHJcbmNvbnN0IHJvdXRlciA9IHJlcXVpcmUoXCJleHByZXNzXCIpLlJvdXRlcigpO1xyXG5jb25zdCBVc2VyID0gcmVxdWlyZShcIi4uL21vZGVsL3VzZXJcIik7XHJcbmNvbnN0IGJjcnlwdCA9IHJlcXVpcmUoXCJiY3J5cHRqc1wiKTtcclxuY29uc3Qgd2VidG9rZW4gPSByZXF1aXJlKFwianNvbndlYnRva2VuXCIpO1xyXG5jb25zdCB7IHJlZ2lzdGVyVmFsaWRhdGlvbiwgbG9naW5WYWxpZGF0aW9uIH0gPSByZXF1aXJlKFwiLi4vdmFsaWRhdGlvblwiKTtcclxuXHJcbmNvbnN0IGFzeW5jTWlkZGxld2FyZSA9IHJlcXVpcmUoXCIuLi9taWRkbGV3YXJlL2FzeW5jTWlkZGxld2FyZVwiKTtcclxuY29uc3QgdXNlclByb2dyZXNzID0gcmVxdWlyZShcIi4uL21vZGVsL3VzZXJQcm9ncmVzc1wiKTtcclxuXHJcblxyXG5jb25zdCB0b2tlbkxpc3QgPSB7fTtcclxuXHJcbi8vUmVnaXN0ZXJcclxucm91dGVyLnBvc3QoXHJcbiAgXCIvcmVnaXN0ZXJcIixcclxuICBhc3luY01pZGRsZXdhcmUoYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICBjb25zdCB7IGVycm9yIH0gPSByZWdpc3RlclZhbGlkYXRpb24ocmVxLmJvZHkpO1xyXG5cclxuICAgIC8vU2VuZHMgZXJyb3IgbWVzc2FnZSBpZiBkYXRhIGlzIG5vdCB2YWxpZFxyXG4gICAgaWYgKGVycm9yKVxyXG4gICAgICByZXR1cm4gcmVzXHJcbiAgICAgICAgLnN0YXR1cyg0MDApXHJcbiAgICAgICAgLnNlbmQoXHJcbiAgICAgICAgICBlcnJvci5kZXRhaWxzLm1hcCgoeCkgPT4geC5tZXNzYWdlKS5qb2luKFwiLCBcIilcclxuICAgICAgICApO1xyXG5cclxuICAgIC8vQ2hlY2tzIGlmIHVzZXIgZGV0YWlscyBhcmUgYWxyZWFkeSBpbiB0aGUgZGF0YWJhc2VcclxuICAgIGNvbnN0IHVzZXJuYW1lRXhpc3QgPSBhd2FpdCBVc2VyLmZpbmRPbmUoeyB1c2VybmFtZTogcmVxLmJvZHkudXNlcm5hbWUgfSk7XHJcbiAgICBjb25zdCBlbWFpbEV4aXN0ID0gYXdhaXQgVXNlci5maW5kT25lKHsgZW1haWw6IHJlcS5ib2R5LmVtYWlsIH0pO1xyXG5cclxuICAgIC8vUmV0dXJucyByZXF1aXJlZCBpbmZvcm1hdGlvbiB0byB0aGUgdXNlclxyXG4gICAgaWYgKGVtYWlsRXhpc3QgJiYgdXNlcm5hbWVFeGlzdClcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5zZW5kKFwiRW1haWwgYW5kIFVzZXJuYW1lIGFscmVhZHkgZXhpc3RzXCIpO1xyXG4gICAgaWYgKGVtYWlsRXhpc3QpIHJldHVybiByZXMuc3RhdHVzKDQwMCkuc2VuZChcIkVtYWlsIGFscmVhZHkgZXhpc3RzXCIpO1xyXG4gICAgaWYgKHVzZXJuYW1lRXhpc3QpIHJldHVybiByZXMuc3RhdHVzKDQwMCkuc2VuZChcIlVzZXJuYW1lIGFscmVhZHkgZXhpc3RzXCIpO1xyXG5cclxuICAgIC8vSGFzaGVzIHRoZSBwYXNzd29yZCB1c2luZyBCY3J5cHRcclxuICAgIGNvbnN0IHNhbHQgPSBhd2FpdCBiY3J5cHQuZ2VuU2FsdFN5bmMoMTApO1xyXG4gICAgY29uc3QgaGFzaFBhc3N3b3JkID0gYXdhaXQgYmNyeXB0Lmhhc2hTeW5jKHJlcS5ib2R5LnBhc3N3b3JkLCBzYWx0KTtcclxuXHJcbiAgICAvL0NyZWF0ZXMgYSBuZXcgdXNlclxyXG4gICAgY29uc3QgdXNlciA9IG5ldyBVc2VyKHtcclxuICAgICAgdXNlcm5hbWU6IHJlcS5ib2R5LnVzZXJuYW1lLFxyXG4gICAgICBlbWFpbDogcmVxLmJvZHkuZW1haWwsXHJcbiAgICAgIHBhc3N3b3JkOiBoYXNoUGFzc3dvcmQsXHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCB1c2VycHJvZ3Jlc3MgPSBuZXcgdXNlclByb2dyZXNzKHtcclxuICAgICAgdXNlcm5hbWU6IHJlcS5ib2R5LnVzZXJuYW1lLFxyXG4gICAgfSk7XHJcblxyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIGF3YWl0IHVzZXIuc2F2ZSgpOyAgXHJcbiAgICAgICBhd2FpdCB1c2VycHJvZ3Jlc3Muc2F2ZSgpOyByZXMuc2VuZChcIlRlc3QgU3VjY2Vzc2Z1bGx5XCIpO1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIHJlcy5zdGF0dXMoNDAwKS5zZW5kKGVycik7XHJcbiAgICB9XHJcbiAgfSlcclxuKTtcclxuXHJcbi8vTG9naW5cclxucm91dGVyLnBvc3QoXHJcbiAgXCIvbG9naW5cIixcclxuICBhc3luY01pZGRsZXdhcmUoYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICBjb25zdCB7IGVycm9yIH0gPSBsb2dpblZhbGlkYXRpb24ocmVxLmJvZHkpO1xyXG5cclxuICAgIC8vQ2hlY2tzIGlmIHVzZXJuYW1lIGV4aXN0c1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZE9uZSh7IHVzZXJuYW1lOiByZXEuYm9keS51c2VybmFtZSB9KTtcclxuICAgIGlmICghdXNlcikge1xyXG4gIFxyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLnNlbmQoXCJJbmNvcnJlY3QgdXNlcm5hbWUgb3IgcGFzc3dvcmRcIik7XHJcblx0fVxyXG4gICAgLy9DaGVja3MgaWYgcGFzc3dvcmQgZW50ZXJlZCBtYXRjaGVzIHRoZSB1c2VybmFtZXMgYWN0dWFsIHBhc3N3b3JkXHJcbiAgICBjb25zdCB2YWxpZFBhc3N3b3JkID0gYXdhaXQgYmNyeXB0LmNvbXBhcmUoXHJcbiAgICAgIHJlcS5ib2R5LnBhc3N3b3JkLFxyXG4gICAgICB1c2VyLnBhc3N3b3JkXHJcbiAgICApO1xyXG4gICAgaWYgKCF2YWxpZFBhc3N3b3JkKSByZXR1cm4gcmVzLnN0YXR1cyg0MDApLnNlbmQoXCJJbnZhbGlkIHVzZXJuYW1lIG9yIHBhc3N3b3JkXCIpO1xyXG5cdCAgXHJcblx0Y29uc3QgYm9keSA9IHtcclxuXHRcdF9pZDogdXNlci5faWQsXHJcblx0XHRlbWFpbDogdXNlci5lbWFpbCxcclxuXHRcdHVzZXJuYW1lOiB1c2VyLnVzZXJuYW1lLFxyXG5cdH07XHJcblxyXG5cclxuICAgIC8vQ3JlYXRlIGFuZCBhc3NpZ24gYSBKU09OIHdlYiB0b2tlblxyXG4gICAgY29uc3QgdG9rZW4gPSB3ZWJ0b2tlbi5zaWduKHtpbmZvOiBib2R5fSwgcHJvY2Vzcy5lbnYuVE9LRU5fU0VDUkVULCB7XHJcbiAgICAgIGV4cGlyZXNJbjogMzAwLFxyXG5cdH0pO1xyXG5cdFxyXG4gICAgY29uc3QgcmVmcmVzaFRva2VuID0gd2VidG9rZW4uc2lnbihcclxuICAgICAgeyBpbmZvOiBib2R5IH0sXHJcbiAgICAgIHByb2Nlc3MuZW52LlRPS0VOX1NFQ1JFVCxcclxuICAgICAgeyBleHBpcmVzSW46IDEwMDAwIH1cclxuICAgICk7XHJcblxyXG4gICAgcmVzLmNvb2tpZShcImFjY2Vzc190b2tlblwiLCB0b2tlbik7XHJcbiAgICByZXMuY29va2llKFwicmVmcmVzaEp3dFwiLCByZWZyZXNoVG9rZW4pO1xyXG5cclxuXHJcbiAgICAvLyBzdG9yZSB0b2tlbnMgaW4gbWVtb3J5XHJcbiAgICB0b2tlbkxpc3RbcmVmcmVzaFRva2VuXSA9IHtcclxuICAgICAgdG9rZW4sXHJcbiAgICAgIHJlZnJlc2hUb2tlbixcclxuICAgICAgZW1haWw6IHVzZXIuZW1haWwsXHJcbiAgICAgIF9pZDogdXNlci5faWQsXHJcbiAgICAgIHVzZXJuYW1lOiB1c2VyLnVzZXJuYW1lLFxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyB0b2tlbiwgcmVmcmVzaFRva2VuIH0pO1xyXG4gIH0pXHJcbik7XHJcblxyXG5yb3V0ZXIucG9zdChcIi90b2tlblwiLCAocmVxLCByZXMpID0+IHtcclxuICBjb25zdCB7IHJlZnJlc2hUb2tlbiB9ID0gcmVxLmJvZHk7XHJcbiAgaWYgKHJlZnJlc2hUb2tlbiBpbiB0b2tlbkxpc3QpIHtcclxuICAgIGNvbnN0IGJvZHkgPSB7XHJcbiAgICAgIGVtYWlsOiB0b2tlbkxpc3RbcmVmcmVzaFRva2VuXS5lbWFpbCxcclxuICAgICAgX2lkOiB0b2tlbkxpc3RbcmVmcmVzaFRva2VuXS5faWQsXHJcbiAgICAgIHVzZXJuYW1lOiB0b2tlbkxpc3RbcmVmcmVzaFRva2VuXS51c2VybmFtZSxcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgdG9rZW4gPSB3ZWJ0b2tlbi5zaWduKHtpbmZvOiBib2R5fSwgcHJvY2Vzcy5lbnYuVE9LRU5fU0VDUkVULCB7XHJcbiAgICAgIGV4cGlyZXNJbjogMzAwLFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gdXBkYXRlIGp3dFxyXG4gICAgcmVzLmNvb2tpZShcImFjY2Vzc190b2tlblwiLCB0b2tlbik7XHJcbiAgICB0b2tlbkxpc3RbcmVmcmVzaFRva2VuXS50b2tlbiA9IHRva2VuO1xyXG4gIFxyXG5cclxuICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgdG9rZW4gfSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJlcy5zdGF0dXMoNDAxKS5qc29uKCk7XHJcbiAgfVxyXG59KTtcclxuXHJcbnJvdXRlci5wb3N0KFwiL2xvZ291dFwiLCAocmVxLCByZXMpID0+IHtcclxuICBpZiAocmVxLmNvb2tpZXMpIHtcclxuICAgIGNvbnN0IHJlZnJlc2hUb2tlbiA9IHJlcS5ib2R5WydyZWZyZXNoVG9rZW4nXTtcclxuICAgIGNvbnNvbGUubG9nKHJlZnJlc2hUb2tlbik7XHJcbiAgICBpZiAocmVmcmVzaFRva2VuIGluIHRva2VuTGlzdCkge1xyXG4gICAgICBkZWxldGUgdG9rZW5MaXN0W3JlZnJlc2hUb2tlbl07IFxyXG4gICAgICByZXMuY2xlYXJDb29raWUoXCJyZWZyZXNoSnd0XCIpO1xyXG4gICAgICByZXMuY2xlYXJDb29raWUoXCJhY2Nlc3NfdG9rZW5cIik7XHJcbiAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgbWVzc2FnZTogXCJsb2dnZWQgb3V0XCIgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXMuc3RhdHVzKDQwMSkuanNvbigpO1xyXG4gICAgfVxyXG4gIH0gZWxzZSB7XHJcbiAgICByZXMuc3RhdHVzKDQwMSkuanNvbigpO1xyXG4gIH1cclxuIFxyXG59KTtcclxuXHJcblxyXG5yb3V0ZXIucG9zdChcIi9kZWxldGVBY2NvdW50XCIsYXN5bmNNaWRkbGV3YXJlKGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIFVzZXIuZGVsZXRlT25lKHsgdXNlcm5hbWU6IHJlcS5ib2R5LnVzZXJuYW1lIH0sIGZ1bmN0aW9uKGVyciwgcmVzdWx0KSB7XHJcbiAgICBpZiAoZXJyKSB7XHJcbiAgICAgIHJlcy5zZW5kKGVycik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXMuc2VuZChyZXN1bHQpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICB1c2VyUHJvZ3Jlc3MuZGVsZXRlT25lKHsgdXNlcm5hbWU6IHJlcS5ib2R5LnVzZXJuYW1lIH0sIGZ1bmN0aW9uKGVyciwgcmVzdWx0KSB7XHJcbiAgICBpZiAoZXJyKSB7XHJcbiAgICAgIHJlcy5zZW5kKGVycik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXMuc2VuZChyZXN1bHQpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59KSk7XHJcblxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7XHJcbiJdfQ==